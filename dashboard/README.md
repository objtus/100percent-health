# Dashboard システム - 技術仕様書

## 概要
Dashboardシステムは、Misskey（分散型SNS）のタイムライン表示、RSSフィード表示、リアルタイム時計機能を統合したWebアプリケーションです。モダンなUI/UXとリアルタイム更新機能を備えています。

## システム構成

### ファイル構成
```
dashboard/
├── dashboard.html      # メインHTMLファイル
├── dashboard.css       # スタイルシート（1132行）
├── main.js            # メイン制御スクリプト（59行）
├── misskey.js         # Misskey API管理スクリプト（1933行）
├── rss.js             # RSSフィード処理スクリプト（197行）
└── clock.js           # 時計機能スクリプト（30行）
```

### 外部依存関係
- jQuery 3.6.0（`../js/jquery-3.6.0.min.js`）

## 技術仕様

### 1. アーキテクチャ
- **フロントエンド専用**: クライアントサイドJavaScriptによるSPA構成
- **モジュラー設計**: 機能別にファイルを分割
- **レスポンシブデザイン**: CSS Grid/Flexboxによるレイアウト
- **リアルタイム更新**: WebSocket + ポーリングのハイブリッド方式

### 2. 主要コンポーネント

#### 2.1 Misskey統合システム（misskey.js）
**クラス**: `MisskeyManager`
- **インスタンス管理**: 複数Misskeyインスタンス対応
- **API統合**: RESTful API + WebSocket
- **認証管理**: APIトークンベース認証
- **タイムライン管理**: ローカル/グローバル/リスト対応

**主要機能**:
- タイムライン取得・表示
- リアルタイムストリーミング
- 投稿機能（公開範囲指定対応）
- リアクション処理
- カスタム絵文字対応
- ファイル添付表示

**WebSocket機能**:
- リアルタイム投稿受信
- リアクション更新
- 接続状態管理
- 自動再接続

#### 2.2 RSSフィードシステム（rss.js）
**対応フィード**:
- はてなブックマーク（総合・世の中）
- GIGAZINE
- Togetter

**特徴**:
- レート制限対策（3秒間隔取得）
- タイムアウト処理（15秒）
- 自動スクロール表示
- エラーハンドリング

#### 2.3 時計システム（clock.js）
**機能**:
- リアルタイム時刻表示
- 日本語日付・曜日表示
- アニメーション効果（点滅区切り文字）

#### 2.4 UI制御システム（main.js）
**機能**:
- ページ初期化
- ヘッダー状態管理
- 投稿フォーム制御
- 自動更新制御

### 3. データフロー

#### 3.1 Misskeyデータ処理
```
API呼び出し → データ取得 → 絵文字処理 → HTML生成 → DOM更新
     ↓
WebSocket → リアルタイム更新 → 差分表示
```

#### 3.2 RSSデータ処理
```
フィード取得 → JSON変換 → 日付ソート → HTML生成 → 自動スクロール
```

### 4. 設定管理

#### 4.1 ローカルストレージ項目
- `misskey_instance`: MisskeyインスタンスURL
- `misskey_token`: API認証トークン
- `misskey_auto_refresh`: 自動更新フラグ
- `misskey_refresh_interval`: 更新間隔
- `misskey_header_collapsed`: ヘッダー折りたたみ状態

#### 4.2 デフォルト設定
- インスタンス: `tanoshii.site`
- 更新間隔: 30秒
- 投稿文字数制限: 3000文字

### 5. エラーハンドリング

#### 5.1 ネットワークエラー
- タイムアウト処理（15秒）
- 自動リトライ機能
- エラー状態表示

#### 5.2 APIエラー
- HTTPステータスコード対応
- レート制限対策
- フォールバック処理

### 6. パフォーマンス最適化

#### 6.1 画像処理
- 遅延読み込み
- プリロード機能
- エラー時の代替表示

#### 6.2 メモリ管理
- 絵文字辞書キャッシュ
- 接続状態管理
- 不要なイベントリスナー削除

### 7. セキュリティ

#### 7.1 認証
- APIトークン管理
- パスワードフィールド使用
- トークン検証

#### 7.2 データ処理
- XSS対策（innerHTML使用時の注意）
- 外部リンク（`rel="noopener noreferrer"`）
- 入力値検証

### 8. ブラウザ対応

#### 8.1 必須機能
- ES6+ JavaScript
- CSS Grid/Flexbox
- WebSocket API
- Fetch API
- LocalStorage

#### 8.2 推奨ブラウザ
- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

### 9. 開発・デバッグ

#### 9.1 ログ出力
- コンソールログ（開発用）
- エラー詳細表示
- パフォーマンス計測

#### 9.2 設定変更
- インスタンス切り替え
- トークン更新
- 更新間隔調整

## 使用方法

### 初期設定
1. MisskeyインスタンスURL設定
2. APIトークン入力
3. 自動更新設定

### キーボードショートカット
- `n`: 投稿フォーム開く
- `Shift + Enter`: 投稿送信
- `Escape`: モーダル閉じる

### タイムライン切り替え
- ローカルタイムライン
- グローバルタイムライン
- リストタイムライン（トークン必要）

## 今後の拡張予定

### 機能追加
- 複数インスタンス同時表示
- 高度なフィルタリング
- テーマカスタマイズ
- モバイル最適化

### 技術改善
- TypeScript移行
- 状態管理ライブラリ導入
- テスト自動化
- CI/CD整備

## 技術的注意事項

### 制限事項
- CORS制限による外部API制約
- ブラウザの同時接続数制限
- LocalStorage容量制限

### 推奨事項
- 定期的なトークン更新
- インスタンス負荷考慮
- ネットワーク環境の安定性確保

---

**最終更新**: 2024年
**開発者**: 100percent-health
**ライセンス**: プロジェクト固有
