$(function(){$("#gallerymaphtml").load("/include/gallerymap.html"),$("#serieshtml").load("/include/series.html"),$("#workshtml").load("/include/works.html"),$("#footerhtml").load("/include/footer.html",function(){updateFooterStats()}),$("#headerhtml").load("/include/header.html"),$("#accesscounterhtml").load("/include/accesscounter.html"),$("#last_updatedhtml").load("/include/last_updated.html"),$("#odaibakohtml").load("/include/odaibako.html"),$("#changeloghtml").load("/include/changelog.html"),$("#changelogmodalhtml").load("/include/changelog.html"),$("#texthtml").load("/include/text.html"),$("#zakkihtml").load("/txt/txt_main.html #zakki-list"),document.querySelector("link[href*=\"1column.css\"]")&&($("body").append("<div id=\"sidebarhtml\"></div>"),$("#sidebarhtml").load("/include/sidebar.html",function(){initSidebar()})),$(document).on("click","#back_to_top, #logo_to_top",function(){const a=document.querySelector("#wrapper")||document.documentElement;a.scrollTo({top:0,behavior:"smooth"})}),$(document).on("click","#back_to_bottom",function(){const a=document.querySelector("#wrapper")||document.body;a.scrollTo({top:a.scrollHeight,behavior:"smooth"}),setTimeout(function(){const b=a.lastElementChild;b&&b.scrollIntoView({behavior:"smooth"})},100)})});function initSidebar(){$(document).on("click","#sidebar-scroll-to-top",function(){const a=document.querySelector("#wrapper")||document.documentElement;a.scrollTo({top:0,behavior:"smooth"})}),$(document).on("click","#sidebar-scroll-to-bottom",function(){const a=document.querySelector("#wrapper")||document.body;a.scrollTo({top:a.scrollHeight,behavior:"smooth"}),setTimeout(function(){const b=a.lastElementChild;b&&b.scrollIntoView({behavior:"smooth"})},100)}),initHeadingFeatures()}function updateFooterStats(){const a=document.getElementById("last-update");a&&fetch("/rss.xml?t="+Date.now()).then(a=>a.ok?a.text():Promise.reject()).then(b=>{const c=new DOMParser().parseFromString(b,"text/xml").querySelector("lastBuildDate");if(c&&c.textContent){const b=new Date(new Date(c.textContent.trim()).getTime()+324e5),d=`${b.getUTCFullYear()}/${(b.getUTCMonth()+1).toString().padStart(2,"0")}/${b.getUTCDate().toString().padStart(2,"0")}`,e=`${d} ${b.getUTCHours().toString().padStart(2,"0")}:${b.getUTCMinutes().toString().padStart(2,"0")}:${b.getUTCSeconds().toString().padStart(2,"0")}`;a.textContent=d;const f=`${b.getUTCFullYear()}-${(b.getUTCMonth()+1).toString().padStart(2,"0")}-${b.getUTCDate().toString().padStart(2,"0")}T${b.getUTCHours().toString().padStart(2,"0")}:${b.getUTCMinutes().toString().padStart(2,"0")}:${b.getUTCSeconds().toString().padStart(2,"0")}.000+09:00`;a.setAttribute("title",e+" JST (\u65E5\u672C\u6A19\u6E96\u6642) | "+f)}else throw new Error}).catch(b=>{console.error("RSS\u66F4\u65B0\u65E5\u53D6\u5F97\u30A8\u30E9\u30FC:",b),a.textContent="---"});const b=document.getElementById("random-msg");if(b&&!b.dataset.initialized){b.dataset.initialized="true";const a=6<=new Date().getHours()&&18>new Date().getHours()?["\u266A","\u2665","\u266B","\u2600","\u2601"]:["\u263D","\u2662","\u25CD","\u263E","\u2606","\u2727"];let c,d=0,e=Math.floor(3*Math.random())+4;const f=()=>c||((a=document.createElement("dialog"))=>(a.id="secret-modal",a.innerHTML=`
        <div class="modal-content">
          <h2>♥ secret found! ♥</h2>
          <p>you found the hidden contents ... but, not yet ...</p>
          <div class="secret-link-and-button">
            <a href="/txt/secret_diary.html">go to the secret page... secret_diary ///</a>
            <a href="">go to the secret page 2 ... under construction ///</a>
            <button id="close-secret-modal">close</button>
          </div>
        </div>
      `,document.body.appendChild(a),a.querySelector("#close-secret-modal").addEventListener("click",()=>a.close()),c=a))(),g=()=>f().showModal(),h=()=>{if(.04>Math.random())return g();if(++d>=e)b.style.transform="translateY(-4px)",setTimeout(()=>b.style.transform="translateY(0px)",100),setTimeout(()=>b.style.opacity="0",150),setTimeout(()=>{b.textContent=a[Math.floor(Math.random()*a.length)],b.style.transform="translateY(-4px)",b.style.opacity="1",setTimeout(()=>b.style.transform="translateY(0px)",50)},250),d=0,e=Math.floor(3*Math.random())+4;else{const a=b.textContent;b.textContent="-",setTimeout(()=>b.textContent=a,150)}};b.textContent=a[Math.floor(Math.random()*a.length)],b.addEventListener("click",h)}}document.addEventListener("DOMContentLoaded",function(){const a=new Set,b=new Set;let c,d,f={moved:0,longPress:0,startTarget:null},g=".nsfw",h="a",i=!1;const j=()=>c||((a=document.createElement("div"))=>(a.style.cssText="position:absolute;top:-9999px;left:-9999px;visibility:hidden;white-space:pre;font-size:12px;line-height:1.4;padding:8px 4px;border-radius:4px;font-family:inherit",a.textContent="\u95B2\u89A7\u6CE8\u610F\n\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u8868\u793A",document.body.appendChild(a),c={width:(r=a.getBoundingClientRect()).width,height:r.height},document.body.removeChild(a),c))(),k=(b=[document])=>b.forEach(b=>{1!==b.nodeType&&b.nodeType||((b.querySelectorAll?.(".nsfw.revealed img")||[]).forEach(b=>(a.add(b.src),(l=b.closest(g).querySelector(h))&&(l.style.pointerEvents="auto"))),(b.querySelectorAll?.(".nsfw:not(.revealed) a[href$=\".jpg\"], .nsfw:not(.revealed) a[href$=\".png\"], .nsfw:not(.revealed) a[href$=\".gif\"], .nsfw:not(.revealed) a[href$=\".webp\"]")||[]).forEach(a=>a.style.pointerEvents="none"),b.classList?.contains?.("nsfw")&&!b.classList.contains("revealed")&&(l=b.querySelector("a[href$=\".jpg\"], a[href$=\".png\"], a[href$=\".gif\"], a[href$=\".webp\"]"))&&(l.style.pointerEvents="none"))});k(),document.addEventListener("touchstart",a=>1===a.touches.length&&(f={moved:0,longPress:0,startTarget:a.target},setTimeout(()=>f.longPress=1,300)),{passive:1}),document.addEventListener("touchmove",()=>f.moved=1,{passive:1});const m=c=>{const d=("ontouchstart"in window),e=c.changedTouches?.[0],i=e?.clientX||c.clientX,k=e?.clientY||c.clientY;if(!(d&&"touchend"===c.type&&f.moved|f.longPress|!c.target.closest(".nsfw, .lum-lightbox-image-wrapper")|f.startTarget?.closest(".nsfw, .lum-lightbox-image-wrapper")!==c.target.closest(".nsfw, .lum-lightbox-image-wrapper"))){if((nsfwCard=c.target.closest(g))&&!c.target.closest(".title, .caption, .date, .tags-section")&&(imageLink=nsfwCard.querySelector(h))){const b=nsfwCard.getBoundingClientRect(),d=nsfwCard.classList.contains("revealed"),e=d&&i>b.right-120&&k<b.top+35,f=j(),g=b.left+b.width/2,h=b.top+.44*b.height,m=!d&&Math.abs(i-g)<=f.width/2&&Math.abs(k-h)<=f.height/2;return d||m||(c.preventDefault(),c.stopPropagation()),void(e|m&&(c.preventDefault(),c.stopPropagation(),nsfwCard.classList.toggle("revealed"),(img=nsfwCard.querySelector("img"))&&(nsfwCard.classList.contains("revealed")?(a.add(img.src),imageLink.style.pointerEvents="auto"):(a.delete(img.src),imageLink.style.pointerEvents="none"))))}(lightbox=document.querySelector(".lum-lightbox.lum-open"))&&!c.target.closest(".lum-close-button, .lum-gallery-button, .lum-previous-button, .lum-next-button")&&((revealedWrapper=lightbox.querySelector(".lum-lightbox-image-wrapper.nsfw-revealed"))?(rect=revealedWrapper.getBoundingClientRect(),i-rect.left>rect.width-100&&52>k-rect.top&&(c.preventDefault(),c.stopPropagation(),revealedWrapper.classList.remove("nsfw-revealed"),revealedWrapper.classList.add("nsfw-filtered"),(img=revealedWrapper.querySelector(".lum-img"))&&(b.delete(img.src),a.delete(img.src),t(img.src,0)))):(filteredWrapper=lightbox.querySelector(".lum-lightbox-image-wrapper.nsfw-filtered"))&&(rect=filteredWrapper.getBoundingClientRect(),100>=Math.abs(i-rect.left-rect.width/2)&&50>=Math.abs(k-rect.top-rect.height/2)&&(c.preventDefault(),c.stopPropagation(),filteredWrapper.classList.remove("nsfw-filtered"),filteredWrapper.classList.add("nsfw-revealed"),(img=filteredWrapper.querySelector(".lum-img"))&&(b.add(img.src),a.add(img.src),t(img.src,1)))))}};document.addEventListener("click",a=>{"ontouchstart"in window||m(a)},{passive:!1,capture:!0}),document.addEventListener("touchend",m,{passive:!1,capture:!0});const n=(a,b=50)=>{clearTimeout(d),d=setTimeout(a,b)},o=(a,b)=>{const c=a.classList.contains("nsfw-filtered"),d=a.classList.contains("nsfw-revealed");return b&&!c||!b&&!d},p=a=>[...document.querySelectorAll(".nsfw img")].find(b=>b.src===a),q=a=>(img=p(a))&&!img.closest(g).classList.contains("revealed"),s=a=>!b.has(a)&&q(a),t=(a,b)=>(img=p(a))&&((card=img.closest(g)).classList.toggle("revealed",b),(link=card.querySelector(h))&&(link.style.pointerEvents=b?"auto":"none")),u=(a,b)=>{if(!i){const c=s(b);o(a,c)&&(i=!0,c?(a.classList.add("nsfw-filtered"),a.classList.remove("nsfw-revealed")):(a.classList.remove("nsfw-filtered"),p(b)?a.classList.add("nsfw-revealed"):a.classList.remove("nsfw-revealed")),setTimeout(()=>i=!1,10))}},v=()=>(lightbox=document.querySelector(".lum-lightbox.lum-open"))&&(wrapper=lightbox.querySelector(".lum-lightbox-image-wrapper"))&&(img=wrapper.querySelector(".lum-img"))&&img.src&&u(wrapper,img.src);new MutationObserver(a=>a.forEach(a=>{i||("attributes"===a.type&&"class"===a.attributeName&&(lightbox=a.target.closest(".lum-lightbox"))?lightbox.classList.contains("lum-open")?n(()=>v(),50):b.clear():"attributes"===a.type&&"src"===a.attributeName&&a.target.classList.contains("lum-img")&&(wrapper=a.target.closest(".lum-lightbox-image-wrapper"))?n(()=>u(wrapper,a.target.src),50):"childList"===a.type&&a.addedNodes.length&&k(a.addedNodes))})).observe(document.body,{attributes:1,attributeFilter:["src","class"],childList:1,subtree:1})});function initHeadingFeatures(){window.headingFeaturesCleanup?.();const a={tocVisible:!1,currentHeadingVisible:!1,headings:[],currentActiveIndex:-1,isTagPage:!1,scrollHandler:null,wrapper:null,tocClickHandlers:[]},b=()=>{const a=document.querySelector("head > title")?.textContent,b=document.getElementById("sidebar-page-title-value");a&&b&&(b.textContent=a);const d=document.lastModified,e=document.getElementById("sidebar-last-modified-value");if(d&&e){const a=new Date(d);e.textContent=`${a.getFullYear()}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`}initializeScrollProgress(),c()},c=()=>{const a=d(),b=document.getElementById("sidebar-page-structure-value");b&&(b.textContent=`${a.headingCount}個 | ${a.charCount.toLocaleString()}字`);const c=document.getElementById("sidebar-page-links-value");c&&(c.textContent=`内部: ${a.internalLinks} | 外部: ${a.externalLinks}`)},d=()=>{const a=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),b=a.length,c=document.querySelector("#wrapper, article, main, body");let d=0;if(c){const a=c.cloneNode(!0);a.querySelectorAll("script, style, noscript, iframe").forEach(a=>a.remove());const b=a.textContent||a.innerText||"";d=b.replace(/\s+/g,"").length}const e=document.querySelectorAll("a[href]");let f=0,g=0;const h=window.location.hostname;return e.forEach(a=>{const b=a.getAttribute("href");b&&(b.startsWith("/")||b.startsWith("#")||b.startsWith("./")||b.startsWith("../")||b.includes(h)||!b.startsWith("http://")&&!b.startsWith("https://")?f++:g++)}),{headingCount:b,charCount:d,internalLinks:f,externalLinks:g}},e=a=>{const b=a.filter(a=>"H3"===a.tagName).length;return window.location.pathname.includes("/tag-page/")||5<b},f=(a,b)=>{const c=a.clientHeight;return b?.9*c:.25*c},g=()=>{if(a.wrapper=document.querySelector("#wrapper")||document.documentElement,!a.wrapper)return void console.error("Scroll wrapper not found");let b;a.scrollHandler=()=>{(a.currentHeadingVisible||a.tocVisible)&&(clearTimeout(b),b=setTimeout(h,16))},a.wrapper.addEventListener("scroll",a.scrollHandler,{passive:!0})},h=()=>{if(!a.wrapper)return;const b=a.wrapper.scrollTop,c=a.wrapper.scrollHeight,d=a.wrapper.clientHeight;if(50>b)return void(0!==a.currentActiveIndex&&0<a.headings.length&&(a.currentActiveIndex=0,k()));if(b+d>=c-10&&0<a.headings.length){const b=a.headings.length-1;return void(a.currentActiveIndex!==b&&(a.currentActiveIndex=b,k()))}const e=f(a.wrapper,a.isTagPage);let g=-1;for(let b=a.headings.length-1;0<=b;b--)if(a.headings[b].getBoundingClientRect().top<=e){g=b;break}-1===g&&0<a.headings.length&&(g=0),-1!==g&&g!==a.currentActiveIndex&&(a.currentActiveIndex=g,k())},i=()=>{if(0<a.headings.length)return!0;const b=document.querySelectorAll("h2, h3, h4, h5, h6");return(a.headings=Array.from(b),0===a.headings.length)?($("#sidebar-toggle-toc, #sidebar-current-heading").hide(),!1):(a.isTagPage=e(a.headings),a.headings.forEach((a,b)=>{a.id||(a.id=`heading-${b}`)}),$("#sidebar-toggle-toc, #sidebar-current-heading").show(),a.currentHeadingVisible=!0,g(),!0)},j=()=>{const b=document.getElementById("sidebar-toc-content");b&&(a.tocClickHandlers.forEach(({element:a,handler:b})=>{a.removeEventListener("click",b)}),a.tocClickHandlers=[],b.innerHTML="",a.headings.forEach((c,d)=>{const e=document.createElement("button");e.className=`sidebar-toc-item level-${c.tagName.toLowerCase().charAt(1)}`,e.textContent=c.textContent.trim(),e.setAttribute("data-target",c.id),e.setAttribute("data-index",d);const f=function(){const b=document.getElementById(this.getAttribute("data-target"));b&&a.wrapper&&a.wrapper.scrollTo({top:b.offsetTop,behavior:"smooth"})};e.addEventListener("click",f),a.tocClickHandlers.push({element:e,handler:f}),b.appendChild(e)}))},k=()=>{const b=a.currentActiveIndex;if(!(0>b)&&(a.tocVisible&&(document.querySelectorAll(".sidebar-toc-item.active").forEach(a=>{a.classList.remove("active")}),document.querySelector(`[data-index="${b}"]`)?.classList.add("active")),a.currentHeadingVisible)){const c=document.getElementById("sidebar-current-heading-value");if(c&&a.headings[b]){let d=getHeadingTextWithoutRuby(a.headings[b]);20<d.length&&(d=d.substring(0,17)+"..."),c.textContent=d,c.setAttribute("title",d),c.style.opacity="0",setTimeout(()=>c.style.opacity="1",50)}}};$(document).on("click","#sidebar-toggle-toc",function(){const b=document.getElementById("sidebar-toc");if(b)if(a.tocVisible)b.style.display="none",a.tocVisible=!1;else{if(!i())return;j(),b.style.display="flex",a.tocVisible=!0,k()}}),$(document).on("click","#sidebar-toc-close",()=>{const b=document.getElementById("sidebar-toc");b&&(b.style.display="none",a.tocVisible=!1)}),$(document).on("click",b=>{if(!a.tocVisible)return;const c=document.getElementById("sidebar-toc"),d=document.getElementById("sidebar-toggle-toc");!c||c.contains(b.target)||d.contains(b.target)||(c.style.display="none",a.tocVisible=!1)});const m=()=>{b(),i()&&(h(),k())};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):setTimeout(m,100),window.headingFeaturesCleanup=()=>{a.scrollHandler&&a.wrapper&&a.wrapper.removeEventListener("scroll",a.scrollHandler),a.tocClickHandlers.forEach(({element:a,handler:b})=>{a.removeEventListener("click",b)}),$("#sidebar-toc").hide(),Object.assign(a,{tocVisible:!1,currentHeadingVisible:!1,headings:[],currentActiveIndex:-1,scrollHandler:null,wrapper:null,tocClickHandlers:[]})},{updateActiveIndexByScroll:h,getState:()=>({...a})}}function initializeScrollProgress(){const a=document.getElementById("sidebar-scroll-progress-value");if(!a)return;updateScrollProgress();const b=document.querySelector("#wrapper")||document.documentElement;if(b){let a;const c=()=>{clearTimeout(a),a=setTimeout(updateScrollProgress,16)};b.addEventListener("scroll",c,{passive:!0});const d=window.headingFeaturesCleanup;window.headingFeaturesCleanup=()=>{d&&d(),b.removeEventListener("scroll",c)}}}function updateScrollProgress(){const a=document.getElementById("sidebar-scroll-progress-value");if(!a)return;const b=document.querySelector("#wrapper")||document.documentElement;if(!b)return;const c=b.scrollTop,d=b.scrollHeight,e=b.clientHeight,f=d-e,g=0>=f?100:Math.min(100,Math.max(0,100*(c/f))),h=6,i=Math.floor(g/100*h),j="#".repeat(i)+"-".repeat(h-i),k=Math.floor(g).toString(),m=k.padStart(3,"0")+"%";a.textContent=`${m}: [${j}]`}window.initHeadingFeatures=initHeadingFeatures;function getHeadingTextWithoutRuby(a){const b=a.cloneNode(!0);return b.querySelectorAll("rt").forEach(a=>a.remove()),b.textContent.trim()}window.gtag||((a=document.createElement("script"))=>(a.async=1,a.src="https://www.googletagmanager.com/gtag/js?id=G-TSRT9G556F",a.onerror=()=>{},a.onload=()=>{try{window.dataLayer=window.dataLayer||[],window.gtag=(...a)=>window.dataLayer.push(a),gtag("js",new Date),gtag("config","G-TSRT9G556F",{send_page_view:1,anonymize_ip:1})}catch(a){}},document.head.appendChild(a)))();