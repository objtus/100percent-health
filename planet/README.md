# Planet 100%health - スクレイピング版

tanoshii.site (Misskey) 特化のスクレイピングベース SNS 集約システム

## 🚀 概要

Planet v2 は従来のRSSベースアプローチから脱却し、直接ウェブページをスクレイピングすることで、より豊富で正確な情報を取得します。

### v1 (RSS) との違い

| 項目 | v1 (RSS) | v2 (スクレイピング) |
|------|----------|-------------------|
| **投稿数** | 最新10-20件 | 20件以上取得可能 |
| **画像情報** | 限定的 | 完全な画像情報 |
| **リアクション** | 取得不可 | いいね・RT・返信数 |
| **リアルタイム性** | RSS更新待ち | 直接取得 |
| **カスタマイズ性** | 固定 | 柔軟な解析ロジック |

## 🛠️ 技術仕様

### アーキテクチャ

```
PlanetScraperV2
├── MisskeyAdapter (tanoshii.site)
│   ├── HTML取得 (CORS プロキシ経由)
│   ├── DOM解析 (投稿抽出)
│   ├── メディア抽出
│   └── リアクション解析
├── キャッシュシステム (10分間)
├── レート制限 (30秒間隔)
└── 表示エンジン
```

### 主要機能

1. **スマートHTML解析**
   - 複数のセレクタパターンでMisskeyの投稿を検出
   - HTMLセマンティクス対応
   - フォールバック解析（テキストパターン）

2. **高品質メディア抽出**
   - 投稿画像の完全抽出
   - 絵文字・アイコン除外
   - 相対URL自動解決

3. **リアクション情報**
   - いいね数・リポスト数・返信数
   - 視覚的なリアクション表示

4. **インテリジェントキャッシュ**
   - 10分間の短期キャッシュ
   - メモリ使用量制限
   - 自動期限切れ処理

## 📁 ファイル構成

```
planet-v2/
├── index.html          # メインページ
├── planet-scraper.js   # スクレイピングエンジン
└── README.md          # このファイル
```

## 🎯 対象サービス

### 現在対応
- **tanoshii.site** (Misskey) - メインターゲット

### 将来対応予定
- 他のMisskeyインスタンス
- Mastodonインスタンス
- カスタムSNS

## ⚙️ 設定

### レート制限
```javascript
MISSKEY_RATE_LIMIT: 30 * 1000  // 30秒間隔
```

### キャッシュ
```javascript
CACHE_DURATION: 10 * 60 * 1000  // 10分間
MAX_CACHE_ENTRIES: 50           // 最大50エントリ
```

### 投稿取得
```javascript
MAX_POSTS_PER_FETCH: 20         // 1回あたり最大20件
MAX_CONTENT_LENGTH: 500         // 最大500文字
MAX_IMAGES_PER_POST: 6          // 最大6枚の画像
```

## 🚦 使用方法

### 基本的な使用

1. `index.html` をブラウザで開く
2. 自動的に tanoshii.site/@health からデータを取得
3. 投稿がリアルタイムで表示される

### 手動操作

- **🔄 更新**: 最新の投稿を再取得
- **🔧 デバッグ**: 開発者ツールで詳細情報表示
- **🗑️ キャッシュクリア**: 保存されたキャッシュを削除

### カスタマイズ

```javascript
// 新しいMisskeyインスタンスを追加
planetScraperV2.addMisskeyInstance(
    'https://misskey.io',     // インスタンスURL
    'username',               // ユーザー名
    'Display Name'            // 表示名
);
```

## 🔧 開発・デバッグ

### デバッグモード

デバッグボタンをクリックすると、コンソールに詳細情報が表示されます：

- Planet v2 インスタンスの状態
- 各アダプターの設定
- 取得した投稿データ
- キャッシュ内容

### よくある問題

1. **投稿が表示されない**
   - コンソールでエラーメッセージを確認
   - CORSプロキシの状態を確認
   - レート制限の可能性

2. **画像が表示されない**
   - 画像URLの有効性を確認
   - CORSポリシーの確認

3. **古いデータが表示される**
   - キャッシュクリアを実行
   - ページをリロード

## 🛡️ セキュリティ・配慮事項

### プライバシー
- 公開投稿のみを取得
- 個人情報の取得は行わない
- 必要最小限のデータのみ保存

### サーバー負荷軽減
- 30秒間隔のレート制限
- インテリジェントキャッシュ
- 効率的なHTML解析

### エラーハンドリング
- グレースフルなデグラデーション
- フォールバック解析
- 詳細なエラーログ

## 📈 今後の計画

### Phase 1 (現在)
- ✅ tanoshii.site 対応
- ✅ 基本的なスクレイピング
- ✅ 画像・リアクション表示

### Phase 2 (予定)
- 🔄 複数インスタンス対応
- 🔄 パフォーマンス最適化
- 🔄 高度なフィルタリング

### Phase 3 (将来)
- ⏳ Mastodon対応
- ⏳ カスタムスクレイピングルール
- ⏳ リアルタイム更新

## 🐛 既知の制限

1. **JavaScript依存サイト**: 一部のMisskeyインスタンスで対応困難
2. **レイアウト変更**: サイト更新時に解析ロジック調整が必要
3. **プロキシ依存**: 外部プロキシサービスの可用性に依存

## 📝 ライセンス

このプロジェクトは実験的な個人用途として開発されています。
商用利用や大規模展開は対象サービスの利用規約を確認してください。

---

**注意**: このシステムはウェブスクレイピングを使用しています。対象サイトの利用規約を遵守し、適切な間隔でアクセスするよう設計されていますが、使用は自己責任でお願いします。
