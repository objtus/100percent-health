# RSS手動更新システム

## 概要

このシステムは、Last.fmの自動更新による「最終更新日」の問題を解決するため、RSS生成時の`lastBuildDate`を手動更新日として利用します。

## 仕組み

### 手動更新の流れ
1. **changelog.htmlを更新** → 新しい更新内容を記述
2. **RSS生成スクリプト実行** → `rss-generator.js`を実行
3. **rss.xmlのlastBuildDate更新** → 現在時刻が記録される
4. **サイト表示に反映** → この日時が「最終更新日」として表示される

### 自動更新の流れ（Last.fm）
1. **GitHub Actionsが実行** → 1時間ごとに自動実行
2. **lastfm-data.jsonのみ更新** → RSSには影響しない
3. **サイト表示は変わらず** → 手動更新日が維持される

## 実装詳細

### 修正されたファイル

#### `include/last_updated.html`
- **変更前**: Neocities APIから更新日を取得
- **変更後**: RSSの`lastBuildDate`から取得
- **表示形式**: `2025/09/18 01:00:54 JST`（時間帯表示付き）
- **エラー時**: `---`を表示

#### `js/main.js` - `updateFooterStats`関数
- **変更前**: Neocities APIから更新日を取得
- **変更後**: RSSの`lastBuildDate`から取得
- **表示形式**: `2025/09/18`（日付のみ）
- **エラー時**: `---`を表示

## 利用方法

### 手動更新時の手順
1. `include/changelog.html`を編集
2. RSS生成スクリプトを実行:
   ```bash
   # Windows
   .\update-rss.bat
   
   # Linux/Mac  
   ./update-rss.sh
   ```
3. 生成された`rss.xml`をアップロード

### 確認方法
- ブラウザの開発者ツールコンソールで確認可能:
  - `✅ RSS手動更新日を取得: 2025/09/18 01:00:54 JST`
  - `✅ フッター更新日を取得: 2025/09/18`

## 技術仕様

### 日本時間変換
- RSSの`lastBuildDate`（UTC）に9時間を加算
- 表示形式: `YYYY/MM/DD HH:MM:SS JST`

### キャッシュ対策
- URL末尾に`?t=タイムスタンプ`を付加してブラウザキャッシュを回避

### エラーハンドリング
- RSS取得失敗 → `---`表示
- XML解析失敗 → `---`表示
- `lastBuildDate`が見つからない → `---`表示

## メリット

✅ **シンプル**: 既存のRSSワークフローを活用  
✅ **確実**: RSS生成＝手動更新の証明  
✅ **軽量**: 追加ファイルや複雑な管理不要  
✅ **保守性**: 現行システムの延長で実装  
✅ **独立性**: Last.fmの自動更新に影響されない

## 注意事項

- RSS生成を忘れると更新日が反映されない
- RSSファイルが破損すると`---`表示になる
- ブラウザキャッシュにより即座に反映されない場合がある（キャッシュバスターで対策済み）
