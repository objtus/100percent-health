<div id="odaibako">
  <style>
    textarea{
     width: 100%;
   }
   #odaimemo{
     font-size: 0.7rem;
   }
  </style>
  <br>
  <p>&gt;お題募集中！</p>
  <form id="custom_form" target="dummy_send_target">
    <textarea type="text" name="entry.429821385" placeholder="odaikudasai" rows="4"></textarea>
    <button type="submit">sousin</button>
  </form>
  <p id="odaimemo">google formを利用しています</p>
  <p id="words_of_thanks">
    あり^^
  </p>
  <style>
    #words_of_thanks {
      display: none;
    }
  </style>
  <script>
    function get_textbox_value(name) {
      const element = document.querySelector(`textarea[type=text][name="${name}"]`);
      if (element.value) {
        return element.value;
      } else {
        return ""
      }
    }

    function ask_before_changing_page(event) {
      event.preventDefault();
      event.returnValue = "";
    }

    document.getElementById("custom_form").addEventListener("submit", function() {
      const dummy_send_target = document.createElement("iframe");
      dummy_send_target.style.display = "none";
      dummy_send_target.name = "dummy_send_target";
      document.getElementById("custom_form").appendChild(dummy_send_target);

      const form_iframe = document.createElement("iframe");
      form_iframe.src = encodeURI(`https://docs.google.com/forms/d/e/1FAIpQLSfC8KazoI0zj__s8l7teLy2xLXv1C0w63inuVtp9atWJFPdNw/formResponse?entry.429821385=${get_textbox_value("entry.429821385")}&submit=Submit`);
      form_iframe.style.display = "none";
      document.getElementById("custom_form").appendChild(form_iframe);

      form_iframe.addEventListener("load", function() {
        document.getElementById("custom_form").remove();
        document.getElementById("words_of_thanks").style.display = "block";
        window.removeEventListener("beforeunload", ask_before_changing_page, false);
      });
    });

    window.addEventListener("beforeunload", ask_before_changing_page);
  </script>
</div>
